<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{View/Layout/AdminLayout.html}">>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thống Kê</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.canvasjs.com/ga/canvasjs.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

    <script th:inline="javascript">
        window.onload = function () {
            CanvasJS.addColorSet("greenShades",
                [//colorSet Array
                    "#2F4F4F",
                    "#008080",
                    "#2E8B57",
                    "#3CB371",
                    "#90EE90"
                ]);
            const chartData = /*[[${chartDataJson}]]*/ '[]';
            const dataPoints = JSON.parse(chartData);
            dataPoints.revenue.forEach(item => {
                item.x = new Date(item.x); // Chuyển chuỗi ISO thành đối tượng Date
            });
            dataPoints.orderCounts.forEach(item => {
                item.x = new Date(item.x); // Chuyển chuỗi ISO thành đối tượng Date
            });
            dataPoints.ticketCounts.forEach(item => {
                item.x = new Date(item.x); // Chuyển chuỗi ISO thành đối tượng Date
            });
            var chart = new CanvasJS.Chart("chartContainer", {
                theme:'light2',
                backgroundColor: "transparent",
                interactivityEnabled: true,
                animationEnabled: true,
                colorSet: "greenShades",
                title:{
                    fontFamily: 'Montserrat',
                    fontWeight: 'bold',
                    text: "Thống Kê Số Lượng Vé, Hóa đơn và Doanh Thu"
                },
                axisY:[{
                    title: "Số lượng",
                    lineColor: "#C24642",
                    tickColor: "#C24642",
                    labelFontColor: "#C24642",
                    titleFontColor: "#C24642",
                    includeZero: true,
                    // suffix: "k",
                    crosshair: {
                        enabled: true
                    }
                }],
                axisY2: {
                    title: "Doanh thu (VND)",
                    lineColor: "#2E8B57",
                    tickColor: "#2E8B57",
                    labelFontColor: "#2E8B57",
                    titleFontColor: "#2E8B57",
                    includeZero: true,
                    suffix: "VND",
                    crosshair: {
                        enabled: true
                    }
                },
                axisX:{
                    valueFormatString: "DD/MM/YYYY",
                    crosshair: {
                        enabled: true,
                        snapToDataPoint: true
                    }
                },
                toolTip:{
                    shared:true
                },
                legend:{
                    cursor:"pointer",
                    verticalAlign: "bottom",
                    horizontalAlign: "left",
                    dockInsidePlotArea: true,
                    itemclick: toggleDataSeries
                },
                data: [{
                    type: "line",
                    showInLegend: true,
                    name: "Số lượng vé",
                    markerType: "square",
                    xValueFormatString: "DD MMM, YYYY",
                    axisYIndex:0,
                    color: "#F08080",
                    dataPoints: dataPoints.ticketCounts
                },
                {
                    type: "line",
                    showInLegend: true,
                    name: "Số lượng Orders",
                    lineDashType: "dash",
                    color: "#7F6084",
                    dataPoints: dataPoints.orderCounts
                },
                {
                    type: "line",
                    showInLegend: true,
                    name: "Doanh thu",
                    lineDashType: "line",
                    axisYType: 'secondary',
                    dataPoints: dataPoints.revenue
                }]
            });
            chart.render();
        }
        function toggleDataSeries(e){
            if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                e.dataSeries.visible = false;
            } else{
                e.dataSeries.visible = true;
            }
            e.chart.render();
        }

    </script>
</head>
<body class="bg-gray-100">
<div layout:fragment="content">
<div class="container mx-auto p-6">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
        <!-- Total Users Card -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-sm font-medium text-gray-600">Total Users</h2>
                <i class="fas fa-users text-gray-400"></i>
            </div>
            <div class="text-3xl font-bold" th:text="${totalUsers}">9,584</div>
            <p class="text-sm text-green-500 flex items-center mt-2">
<!--                <i class="fas fa-arrow-up mr-1"></i>-->
<!--                6.3% up from yesterday-->
            </p>
        </div>

        <!-- New Orders Monthly Card -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-sm font-medium text-gray-600">New Orders Monthly</h2>
                <i class="fas fa-shopping-cart text-gray-400"></i>
            </div>
            <div class="text-3xl font-bold" th:text="${newMonthlyOrders}"></div>
            <p class="text-sm text-green-500 flex items-center mt-2">
            </p>
        </div>

        <!-- New Tickets Sold Monthly Card -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-sm font-medium text-gray-600">New Tickets Sold Monthly</h2>
                <i class="fas fa-ticket-alt text-gray-400"></i>
            </div>
            <div class="text-3xl font-bold" th:text="${newMonthlyTickets}"></div>
            <p class="text-sm text-red-500 flex items-center mt-2">
            </p>
        </div>
    </div>
<!--    <select class="border rounded-md px-3 py-2 text-gray-700">-->
<!--        <option>Daily</option>-->
<!--        <option>Weekly</option>-->
<!--        <option selected>Monthly</option>-->
<!--        <option>Yearly</option>-->
<!--    </select>-->
    <!-- Sales Details Chart -->
    <div class="bg-white rounded-lg shadow-md p-6 h-full">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-lg font-semibold text-gray-700">Dashboard</h2>
            <form method="GET" action="/admin/statistics" class="flex items-center">
                <input type="datetime-local" name="startDate" class="border rounded-md px-3 py-2 text-gray-700 mr-4">
                <input type="datetime-local" name="endDate" class="border rounded-md px-3 py-2 text-gray-700 mr-4">
                <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Lọc</button>
            </form>
        </div>
        <div id="chartContainer" class="w-full h-96"></div>
    </div>
</div>
</div>
</body>
</html>

